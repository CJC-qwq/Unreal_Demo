# 虚幻引擎5 Demo功能实现技术回顾

## 第三人称射击Demo技术实现

### 角色动作系统
- **动画蓝图实现**：使用动画状态机管理不同移动状态（站立、行走、奔跑）
- **混合空间技术**：基于速度和方向参数混合多个动画，实现平滑过渡
- **骨骼通知(AnimNotify)**：在特定动画帧触发射击特效和伤害计算

### 锁定追踪系统
- **基于球形追踪(Sphere Trace)检测**：从相机发射追踪线判断可锁定目标
- **使用Spring Arm组件**：实现相机在锁定模式下的平滑跟随
- **插值旋转(RInterp)函数**：角色朝向目标时的平滑转向效果
- **锁定状态下的子弹追踪**：修改弹道发射角度，添加轻微追踪效果

### 敌人AI系统
- **行为树(Behavior Tree)设计**：
  - 感知系统检测玩家
  - 巡逻路径点系统实现巡逻
  - 攻击决策与距离判断
- **黑板(Blackboard)变量**：存储目标位置、警戒状态等AI决策关键数据
- **EQS查询系统**：寻找战术位置和掩体点

## 第三人称闯关Demo技术实现

### 表里世界切换系统
- **场景复制与Layer技术**：两个世界实际为同一场景的不同可见层
- **Post Process材质**：切换世界时的视觉效果转场
- **Stencil Buffer技术**：控制物体在特定世界的可见性
- **蓝图中使用Timeline节点**：实现平滑的世界切换过渡效果

### 相机拍摄投影系统
- **Scene Capture组件**：捕获拍摄对象的图像
- **Dynamic Material Instance**：将捕获图像应用到投影物体表面
- **Slice Procedural Mesh技术**：
  - 使用Procedural Mesh Component动态生成投影物体网格
  - 通过几何切片算法(Slice)处理捕获对象的形状信息
  - 实现更精确的物体轮廓和适应性变形
  - 支持复杂形状物体的真实投影和交互
- **非破坏性切割与数据存储**：
  - 使用碰撞检测确定切割平面与物体的交点
  - 生成临时的切割几何数据但不应用于原物体
  - 将切割结果保存在Actor Component的变量中
  - 原物体保持视觉完整性，切割仅在数据层面完成
- **延迟具象化机制**：
  - 投影时通过SpawnActor从存储的几何数据构建新物体
  - 使用Runtime Mesh Construction实时生成切割后的网格
  - 应用与原物体相同的材质但通过材质参数控制透明度和视觉效果
  - 实现"拍摄-存储-投影"的完整工作流
- **Actor Spawning机制**：基于原始物体生成投影物体
- **物理模拟延迟激活**：使用Set Actor Enable Collision延迟开启碰撞

### 多角色控制系统
- **Possess/Unpossess函数**：切换控制的角色
- **Input Mode切换**：不同角色使用不同输入映射
- **Camera Blend**：角色切换时的相机平滑过渡
- **AI控制临时接管**：角色切换时原角色由简单AI控制

## 俯视角RPG Demo技术实现

### 技能系统实现
- **GameplayAbilitySystem简化版**：自定义能力激活和冷却系统
- **事件分发器(Event Dispatcher)**：技能触发时广播事件给特效系统
- **Spawn Actor循环**：生成流星火雨等多重特效元素
- **物理力场组件(Radial Force)**：实现龙卷风吸引效果

### 存档系统
- **Save Game对象**：存储玩家位置、血量和关卡进度
- **异步存档(Async Save Game)**：避免存档过程卡顿
- **Game Instance**：管理存档数据在关卡间的持久化
- **用户控件(UMG)交互**：死亡后的存档读取界面

### 敌人生成与管理
- **对象池化技术**：优化大量敌人的生成与销毁
- **Wave生成系统**：基于玩家进度动态生成敌人
- **Nav Mesh动态重建**：确保新生成敌人能正确寻路
- **Gameplay Tags**：标记不同类型敌人的属性和行为模式

## 通用技术实现

### 伤害系统
- **接口(Interface)设计**：可伤害物体实现通用接口
- **反射系统(Reflection)**：动态获取伤害接收者的属性
- **事件驱动伤害响应**：受击反馈、特效和音效触发
- **组件合成架构**：健康组件(Health Component)与角色分离

### 性能优化
- **LOD系统**：根据距离调整模型和特效复杂度
- **蓝图函数库**：复用常见功能减少重复逻辑
- **事件延迟与节流(Throttling)**：避免频繁更新卡顿
- **异步资源加载**：大型关卡和资源使用异步加载减少卡顿 